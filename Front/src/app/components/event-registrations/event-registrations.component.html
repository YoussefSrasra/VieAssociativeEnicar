<div class="row">
  <div class="col-12">
    <app-card headerTitle="Suivi des Inscriptions aux Événements">
      <!-- Liste des événements -->
      <div class="table-responsive mb-4">
        <table class="table table-hover">
          <thead>
            <tr>
              <th>Événement</th>
              <th>Nombre d'inscrits</th>
              <th>Liste d'attente</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            @for (event of events; track event.id) {
              <tr (click)="selectEvent(event)" [class.table-primary]="selectedEvent?.id === event.id">
                <td>{{ event.eventName }}</td>
                <td>{{ event.registeredCount }}</td>
                <td>{{ event.waitingListCount || 0 }}</td>
                <td>
                  <button class="btn btn-sm btn-outline-primary" (click)="sendReminder(event); $event.stopPropagation()">
                    <i class="fas fa-bell"></i> Envoyer Rappel
                  </button>


                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>

      <!-- Détails des participants -->
     <!-- Détails des participants -->
     <pre *ngIf="selectedEvent" class="d-none"> <!-- Cachez avec d-none pour production -->
      {{ {
        selectedEvent: selectedEvent,
        participants: participants,
        filteredParticipants: filteredParticipants
      } | json }}
    </pre>
@if (selectedEvent) {
  <div class="card mt-3">
    <div class="card-header">
      <h5>Participants - {{ selectedEvent.eventName }}</h5>
    </div>
    <div class="card-body">
      <!-- Add this near your table -->

      @if (isLoading) {
        <div class="text-center">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Chargement...</span>
          </div>
        </div>
      }
      @else if (filteredParticipants.length === 0) {
        <div class="alert alert-info">Aucun participant trouvé</div>
      }

      @else {

        <div class="table-responsive">
          <table class="table">
            <!-- En-tête du tableau (structure fixe, pas dans la boucle) -->
            <thead>
              <tr>
                <th>Nom</th>
                <th>Prénom</th>
                <th>Email</th>
                <th>Date Inscription</th>
                <th>Comité</th>
                <th>Rôle</th>
                <th>Niveau Études</th>
                <th>Actions</th> <!-- Ajout de la colonne des boutons -->
              </tr>
            </thead>

            <!-- Corps du tableau (contenu dynamique avec @for) -->
            <tbody>
              @for (participant of filteredParticipants; track participant.id) {
                <tr>
                  <td>{{ participant.nom }}</td>
                  <td>{{ participant.prenom }}</td>
                  <td>{{ participant.email }}</td>
                  <td>{{ participant.createdAt | date:'dd/MM/yyyy' }}</td>
                  <td>{{ participant.comite }}</td>
                  <td>{{ participant.participationType }}</td>
                  <td>{{ participant.niveauEtudes }}</td>
                  <td>
                    <div class="btn-group" role="group">
                      <button class="btn btn-success btn-sm"
                              (click)="approveParticipant(participant.id)">
                        <i class="fas fa-check"></i> Approuver
                      </button>
                      <button class="btn btn-danger btn-sm ms-2"
                              (click)="rejectParticipant(participant.id)">
                        <i class="fas fa-times"></i> Refuser
                      </button>
                      <button *ngIf="participant.participationType === 'Responsable'"
                              class="btn btn-sm btn-outline-warning ms-2"
                              (click)="generateFormForResponsible(participant); $event.stopPropagation()">
                        <i class="fas fa-edit"></i> Générer Formulaire
                      </button>
                    </div>
                  </td>
                </tr>


              }
            </tbody>
          </table>

        </div>
      }
    </div>
  </div>
}
    </app-card>
  </div>
</div>
