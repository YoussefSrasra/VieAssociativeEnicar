<div class="container">
  <!-- Error message -->
  <div *ngIf="error" class="alert alert-danger alert-dismissible fade show py-1" role="alert">
    <small>{{ error }}</small>
    <button type="button" class="btn-close btn-close-xs" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>

  <!-- Loading indicator -->
  <div *ngIf="loading" class="text-center py-3">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>

  <!-- Clubs grid -->
  <div *ngIf="!loading" class="row g-2">
    <div *ngFor="let club of clubs" class="col-md-4">
      <div class="card h-100 border-0 ultra-compact-card">
        <!-- TINY blue header -->
        <div class="card-img-top bg-gradient-primary"></div>
        
        <div class="card-body text-center pt-0 px-2 pb-2">
          <!-- BIGGER icon -->
          <div class="club-icon-lg rounded-circle d-inline-flex align-items-center justify-content-center mb-1">
            <ng-container *ngIf="club.logo; else defaultIcon">
              <img [src]="getSafeLogoUrl(club.logo)" alt="Logo {{club.name}}" class="club-logo-img">
            </ng-container>
            <ng-template #defaultIcon>
              <i class="fas fa-users text-primary"></i>
            </ng-template>
          </div>
          
          <!-- Club name -->
          <h3 class="h6 card-title mb-1">{{ club.name }}</h3>
          
          <!-- SPECIALTY -->
          <div class="specialty-container mb-2 py-1">
            <span class="club-badge">{{ club.specialty }}</span>
          </div>
          
          <button (click)="openEnrollmentModal(club)" class="btn btn-xs btn-outline-primary rounded-pill px-2">
            Enroll
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Enrollment Modal -->
<div *ngIf="showEnrollmentModal" class="modal-backdrop fade show"></div>
<div *ngIf="showEnrollmentModal" class="modal fade show d-block">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Inscription à {{selectedClub?.name}}</h5>
        <button type="button" class="btn-close" (click)="showEnrollmentModal = false"></button>
      </div>
      
      <div class="modal-body">
        <div *ngIf="formSubmissionError" class="alert alert-danger mb-3">
          {{ formSubmissionError }}
        </div>
        
        <form #enrollmentForm="ngForm" (ngSubmit)="submitEnrollment(enrollmentForm)">
          <input type="hidden" [(ngModel)]="enrollmentData.clubId" name="clubId">
          
          <div class="row g-3">
            <div class="col-md-6">
              <label for="nom" class="form-label">Nom</label>
              <input type="text" class="form-control" id="nom"
                     [(ngModel)]="enrollmentData.nom" 
                     name="nom"
                     #nom="ngModel"
                     required>
              <div *ngIf="nom.invalid && (nom.dirty || nom.touched)" class="text-danger small">
                Le nom est requis
              </div>
            </div>
            
            <div class="col-md-6">
              <label for="prenom" class="form-label">Prénom</label>
              <input type="text" class="form-control" id="prenom"
                     [(ngModel)]="enrollmentData.prenom"
                     name="prenom"
                     #prenom="ngModel"
                     required>
              <div *ngIf="prenom.invalid && (prenom.dirty || prenom.touched)" class="text-danger small">
                Le prénom est requis
              </div>
            </div>
            
            <div class="col-md-6">
              <label for="dateNaissance" class="form-label">Date de naissance</label>
              <input type="date" class="form-control" id="dateNaissance"
                     [(ngModel)]="enrollmentData.dateNaissance"
                     name="dateNaissance"
                     #dateNaissance="ngModel"
                     required>
              <div *ngIf="dateNaissance.invalid && (dateNaissance.dirty || dateNaissance.touched)" class="text-danger small">
                La date de naissance est requise
              </div>
            </div>
            
            <div class="col-md-6">
              <label for="email" class="form-label">Email</label>
              <input type="email" class="form-control" id="email"
                     [(ngModel)]="enrollmentData.email"
                     name="email"
                     #email="ngModel"
                     required email>
              <div *ngIf="email.invalid && (email.dirty || email.touched)" class="text-danger small">
                Un email valide est requis
              </div>
            </div>
            
            <div class="col-md-6">
              <label for="numeroTelephone" class="form-label">Téléphone</label>
              <input type="tel" class="form-control" id="numeroTelephone"
                     [(ngModel)]="enrollmentData.numeroTelephone"
                     name="numeroTelephone"
                     #phone="ngModel"
                     required>
              <div *ngIf="phone.invalid && (phone.dirty || phone.touched)" class="text-danger small">
                Le numéro de téléphone est requis
              </div>
            </div>
            
            <div class="col-md-6">
              <label for="niveauEtude" class="form-label">Niveau d'étude</label>
              <select id="niveauEtude" class="form-select"
                      [(ngModel)]="enrollmentData.niveauEtude"
                      name="niveauEtude"
                      #niveauEtude="ngModel"
                      required>
                <option value="" disabled selected>Sélectionnez votre niveau</option>
                <option value="1ere">1ère année</option>
                <option value="2eme">2ème année</option>
                <option value="3eme">3ème année</option>
              </select>
              <div *ngIf="niveauEtude.invalid && (niveauEtude.dirty || niveauEtude.touched)" class="text-danger small">
                Le niveau d'étude est requis
              </div>
            </div>
            
            <div class="col-md-6">
              <label for="departementEtude" class="form-label">Département d'étude</label>
              <select id="departementEtude" class="form-select"
                      [(ngModel)]="enrollmentData.departementEtude"
                      name="departementEtude"
                      #departementEtude="ngModel"
                      required>
                <option value="" disabled selected>Sélectionnez votre département</option>
                <option value="informatique">Informatique</option>
                <option value="mecatronique">Mécatronique</option>
                <option value="industriel">Industriel</option>
              </select>
              <div *ngIf="departementEtude.invalid && (departementEtude.dirty || departementEtude.touched)" class="text-danger small">
                Le département d'étude est requis
              </div>
            </div>
            
            <div class="col-12">
              <label for="messageMotivation" class="form-label">Motivation (optionnel)</label>
              <textarea id="messageMotivation" class="form-control"
                        [(ngModel)]="enrollmentData.messageMotivation"
                        name="messageMotivation"
                        rows="4"></textarea>
            </div>
          </div>

          <div class="modal-footer mt-4">
            <button type="button" class="btn btn-outline-secondary" (click)="showEnrollmentModal = false">
              Annuler
            </button>
            <button type="submit" class="btn btn-primary" [disabled]="enrollmentForm.invalid">
              Soumettre l'inscription
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>