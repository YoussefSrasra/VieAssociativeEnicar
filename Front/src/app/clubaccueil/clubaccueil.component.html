<div *ngIf="!loading" class="clubs-grid">
  <div *ngFor="let club of filteredClubs" class="club-card">
    
    <div class="club-image">
      <ng-container *ngIf="club.logo; else defaultIcon">
        <img [src]="getSanitizedLogo(club.logo)" alt="Logo {{club.name}}" class="club-logo">
      </ng-container>
      <ng-template #defaultIcon>
        <div class="default-icon">
          <i class="bi bi-people-fill"></i>
        </div>
      </ng-template>
    </div>

    <div class="club-info">
      <h3 class="club-name">{{ club.name }}</h3>
      <p class="club-specialty">{{ club.specialty }}</p>

      <p *ngIf="club.description" class="club-description">
        {{ club.description }}
      </p>

      <div class="club-meta">
        <span *ngIf="club.creationDate" class="meta-item">
          <i class="bi bi-calendar"></i> {{ formatDate(club.creationDate) }}
        </span>
        <span *ngIf="club.membersCount !== undefined" class="meta-item">
          <i class="bi bi-people"></i> {{ club.membersCount }} membres
        </span>
      </div>

      <button (click)="openEnrollmentModal(club)" class="join-button">
        S'inscrire
      </button>
    </div>

  </div>
</div>


  <!-- No clubs message -->
  <div *ngIf="!loading && filteredClubs.length === 0 && !error" class="no-clubs">
    <div class="no-clubs-icon">üèõÔ∏è</div>
    <h3>Aucun club disponible pour le moment</h3>
    <p *ngIf="searchTerm">Aucun r√©sultat pour "{{ searchTerm }}"</p>
  </div>

<!-- Enrollment Modal -->
<div *ngIf="showEnrollmentModal" class="modal-overlay" (click)="showEnrollmentModal = false"></div>
<div *ngIf="showEnrollmentModal" class="modal-container">
  <div class="modal-content">
    <div class="modal-header">
      <h3 class="modal-title">Inscription √† {{selectedClub?.name}}</h3>
      <button class="modal-close" (click)="showEnrollmentModal = false">&times;</button>
    </div>

    <div class="modal-body">
      <div *ngIf="formSubmissionError" class="error-message">
        {{ formSubmissionError }}
      </div>

      <form #enrollmentForm="ngForm" (ngSubmit)="submitEnrollment(enrollmentForm)">
        <input type="hidden" [(ngModel)]="enrollmentData.clubId" name="clubId">

        <div class="form-grid">
          <div class="form-group">
            <label for="nom">Nom</label>
            <input type="text" id="nom"
                   [(ngModel)]="enrollmentData.nom"
                   name="nom"
                   #nom="ngModel"
                   required>
            <div *ngIf="nom.invalid && (nom.dirty || nom.touched)" class="error-text">
              Le nom est requis
            </div>
          </div>

          <div class="form-group">
            <label for="prenom">Pr√©nom</label>
            <input type="text" id="prenom"
                   [(ngModel)]="enrollmentData.prenom"
                   name="prenom"
                   #prenom="ngModel"
                   required>
            <div *ngIf="prenom.invalid && (prenom.dirty || prenom.touched)" class="error-text">
              Le pr√©nom est requis
            </div>
          </div>

          <div class="form-group">
            <label for="dateNaissance">Date de naissance</label>
            <input type="date" id="dateNaissance"
                   [(ngModel)]="enrollmentData.dateNaissance"
                   name="dateNaissance"
                   #dateNaissance="ngModel"
                   required>
            <div *ngIf="dateNaissance.invalid && (dateNaissance.dirty || dateNaissance.touched)" class="error-text">
              La date de naissance est requise
            </div>
          </div>

          <div class="form-group">
            <label for="email">Email</label>
            <input type="email" id="email"
                   [(ngModel)]="enrollmentData.email"
                   name="email"
                   #email="ngModel"
                   required email
                   placeholder="nom.prenom@enicar.ucar.tn">
            <div *ngIf="email.invalid && (email.dirty || email.touched)" class="error-text">
              <span *ngIf="email.errors?.['required']">Un email est requis</span>
             <!-- <span *ngIf="email.errors?.['email']">Format d'email invalide</span>-->
           
            </div>
          </div>

          <div class="form-group">
            <label for="numeroTelephone">T√©l√©phone</label>
            <input type="tel" id="numeroTelephone"
                   [(ngModel)]="enrollmentData.numeroTelephone"
                   name="numeroTelephone"
                   #phone="ngModel"
                   required>
            <div *ngIf="phone.invalid && (phone.dirty || phone.touched)" class="error-text">
              Le num√©ro de t√©l√©phone est requis
            </div>
          </div>

          <div class="form-group">
            <label for="niveauEtude">Niveau d'√©tude</label>
            <select id="niveauEtude"
                    [(ngModel)]="enrollmentData.niveauEtude"
                    name="niveauEtude"
                    #niveauEtude="ngModel"
                    required>
              <option value="" disabled selected>S√©lectionnez votre niveau</option>
              <option value="1ere">1√®re ann√©e</option>
              <option value="2eme">2√®me ann√©e</option>
              <option value="3eme">3√®me ann√©e</option>
            </select>
            <div *ngIf="niveauEtude.invalid && (niveauEtude.dirty || niveauEtude.touched)" class="error-text">
              Le niveau d'√©tude est requis
            </div>
          </div>

          <div class="form-group">
            <label for="departementEtude">D√©partement d'√©tude</label>
            <select id="departementEtude"
                    [(ngModel)]="enrollmentData.departementEtude"
                    name="departementEtude"
                    #departementEtude="ngModel"
                    required>
              <option value="" disabled selected>S√©lectionnez votre d√©partement</option>
              <option value="informatique">Informatique</option>
              <option value="mecatronique">M√©catronique</option>
              <option value="industriel">Industriel</option>
              <option value="infotronique">infotronique</option>
            </select>
            <div *ngIf="departementEtude.invalid && (departementEtude.dirty || departementEtude.touched)" class="error-text">
              Le d√©partement d'√©tude est requis
            </div>
          </div>

          <div class="form-group full-width">
            <label for="messageMotivation">Motivation (optionnel)</label>
            <textarea id="messageMotivation"
                      [(ngModel)]="enrollmentData.messageMotivation"
                      name="messageMotivation"
                      rows="4"></textarea>
          </div>
        </div>
        <div *ngIf="showSuccessMessage" class="success-message">
          <div class="success-icon">‚úì</div>
          <div class="success-text">{{ successMessage }}</div>
        </div>

        <div class="modal-footer">
          <button type="button" class="cancel-button" (click)="showEnrollmentModal = false">
            Annuler
          </button>
          <button type="submit" class="submit-button" [disabled]="enrollmentForm.invalid">
            Soumettre l'inscription
          </button>
        </div>
        <!-- Success message -->

      </form>
    </div>
  </div>
</div>